# Тестовое задание для Embedded разработчика

## Описание
Данный проект представляет собой эмуляцию микроконтроллера с базовым функционалом GPIO и MQTT-коммуникацией. Ниже приведены требования и задачи по доработке существующего функционала.

## Реализованный функционал
### Управление RGB-светодиодом через MQTT

- Поддержка пинов 3 (Red), 5 (Green) и 6 (Blue) для управления RGB-светодиодом.
- Обработка команды set_rgb в формате JSON:
```json
     {
       "command": "set_rgb",
       "red": 255,
       "green": 100,
       "blue": 50
     }
   ```
- Валидация значений цвета (должны быть в диапазоне 0–255).
- Подтверждение выполненной команды публикуется в MQTT-топик: `embedded/pins/state`

### Поддержка аналогового входа (эмуляция датчика температуры)

- Реализована функция analogRead(pin) для чтения аналоговых значений.
- Эмуляция аналогового температурного датчика на пине A0.
- Значения температуры генерируются случайным образом в диапазоне 20–30°C.
-Периодическая публикация температуры каждые 5 секунд в топик: `embedded/sensors/temperature`

### Обработка ошибок
- Валидация всех входящих MQTT-команд и параметров.
- Публикация ошибок в отдельный MQTT-топик:`embedded/errors`
- Обработка следующих ошибок:
   - Некорректная команда
   - Неверные значения пинов
   - Неправильный формат JSON
   - Выход значений за допустимые пределы


### GPIO функции
В приложении реализованы следующие функции, имитирующие работу с GPIO микроконтроллера:

1. `pinMode(pin, isOutput)` - установка режима работы пина
   - `pin` - номер пина (uint8_t)
   - `isOutput` - режим работы (true - выход, false - вход)

2. `digitalRead(pin)` - чтение состояния пина
   - `pin` - номер пина (uint8_t)
   - Возвращает текущее состояние пина (true - HIGH, false - LOW)

3. `digitalWrite(pin, value)` - запись состояния пина
   - `pin` - номер пина (uint8_t)
   - `value` - значение для записи (true - HIGH, false - LOW)

### MQTT функционал
- Подключение к MQTT брокеру (EMQX)
- Автоматическое переподключение при потере связи
- Публикация состояния пинов в топик `embedded/pins/state`
- Подписка на команды в топике `embedded/control`
- Поддержка команд:
  - `restart` - перезапуск контроллера

### Дополнительные функции
- Обработка переменных окружения для конфигурации
- Логирование операций
- Задержки для снижения нагрузки на CPU
- Механизм перезапуска контроллера

## Запуск приложения

### Требования
- Docker и Docker Compose
- Make (опционально)

### Через Makefile
```bash
# Сборка и запуск
make up

# Остановка
make down

# Просмотр логов
make logs
```

### Через Docker Compose напрямую
```bash
# Запуск
docker-compose up -d

# Остановка
docker-compose down

# Просмотр логов
docker-compose logs -f
```

## Конфигурация
Приложение использует следующие переменные окружения:
- `MQTT_HOST` - адрес MQTT брокера (по умолчанию: localhost)
- `MQTT_PORT` - порт MQTT брокера (по умолчанию: 1883)
- `MQTT_USERNAME` - имя пользователя MQTT
- `MQTT_PASSWORD` - пароль MQTT

## Структура проекта
```
.
├── main.cpp          # Основной код приложения
├── Dockerfile        # Конфигурация Docker
├── docker-compose.yml # Конфигурация Docker Compose
├── Makefile          # Упрощенные команды для работы с Docker
└── README.md         # Документация
``` 